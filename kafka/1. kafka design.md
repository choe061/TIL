## 목차
[1. 특징](#특징)

[2. 데이터 모델](#데이터-모델)

[3. HA](#HA)

## 특징
* 링크드인에서 Kafka 를 설계할때 중점으로 정한 부분
  1. 데이터 파이프라인을 표준화하고 통합
  2. 높은 처리량과 빠른 메시지 전송
* 이에 따라 구현된 기능
  * [분산 시스템](#분산-시스템)
  * [페이지 캐시](#페이지-캐시)
  * [배치 전송 처리](#배치-전송-처리)

#### 분산 시스템
* 분산 시스템에서 얻을 수 있는 일반적인 장점을 취할 수 있다.
  * 단일 시스템보다 더 높은 성능
  * 한 노드가 장애 상황인 경우 다른 노드가 대신 처리
  * 시스템 확장이 용이

#### 페이지 캐시
* Kafka 는 처리량을 높이기 위해 OS 페이지 캐시를 사용한다.

###### [OS 페이지 캐시(wikipedia)](https://en.wikipedia.org/wiki/Page_cache)
* disk cache 로도 불린다.
* HDD, SSD 같은 보조 저장 장치로부터 생성된 페이지의 캐시이다. main memory 와 비교하면 hard disk 의 read/writes 는 random access 를 하기 때문에 disk 탐색에 대한 비용이 비싸다. 그래서 main memory 가 클수록 더 많은 데이터를 캐시할 수 있기 때문에 성능이 향상된다.
* os 는 main memory 에서 사용하지 않는 일부를 페이지 캐시로 유지한다. 그래서 캐시된 페이지에 더 빠르게 액세스할 수 있고 전체적인 성능을 향상시킬 수 있다.
* application 에 할당되지 않은 물리 메모리가 대게 페이지 캐시를 위한 메모리로 사용된다.

#### 배치 전송 처리
* 데이터를 주고받는 과정에서 발생하는 IO 도 빈번하게 발생하면 성능 저하의 원인이 된다. 카프카에서는 이러한 작은 IO 들도 모아서 한번에 처리하는 `배치 작업` 으로 처리한다. 그러면 예를들어 5개의 데이터를 각각 주고받으면 네트워크 왕복을 5번 해야하는데, 배치 작업으로 5개의 데이터를 1번의 네트워크 통신으로 전송한다면 네트워크 왕복에 대한 오버헤드를 줄일 수 있다.

## 데이터 모델
* 카프카의 고성능, 고가용성을 설명하기 위해 `토픽` 과 `파티션` 이라는 개념을 알아야 한다.

#### 토픽
* 메시지를 주고받는 논리적인 개념

#### 파티션
* 토픽을 구성하는 데이터 저장소
* 수평 확장이 가능한 물리적인 단위
* `토픽` 은 이해가 가지만, `파티션` 은 처음 카프카를 접하다보니 왜 하나의 토픽을 또 파티션으로 분리하는지 잘 이해가 가지 않는다.
* 파티션 존재의 이유
  * 파티션이 없다면?
    * 여러 개의 메시지를 하나의 토픽에 전송한다면 병렬로 처리하여 성능을 올릴 수 있다. 하지만, 메시지 순서를 보장해야 한다면 병렬로 처리할 수 없다.
  * 파티션이 있다면?
    * 파티션을 여러 개로 나누고 각 파티션에 나누어 전송한다면, 성능을 올릴 수 있다. 개별 파티션으로의 메시지 순서는 보장할 수 있다. 하지만, 다른 파티션들과의 메시지 순서는 보장할 수 없다.
    * 빠른 전송을 위해서 파티션을 늘리는 것 뿐만아니라 파티션만큼 프로듀서도 늘려야 자원을 효율적으로 사용하면서 성능을 끌어올릴 수 있다.

## HA
