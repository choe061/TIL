## ëª©ì°¨

[1. í˜ì´ì§• ì²˜ë¦¬](#í˜ì´ì§•-ì²˜ë¦¬)

[2. Spring DATA JPA](#Spring-DATA-JPA)

[3. QueryDSL](#QueryDSL)

## í˜ì´ì§• ì²˜ë¦¬
* ë” ë¶ˆëŸ¬ì˜¤ê¸° ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í•˜ë©´ total count ë¥¼ êµ¬í•  í•„ìš”ê°€ ì—†ê³  ì„±ëŠ¥ì´ ì¢‹ê² ì§€ë§Œ, ë°ì´í„°ê°€ ì ê±°ë‚˜ ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ í˜ì´ì§• ì²˜ë¦¬ê°€ í•„ìš”í•œ ê²½ìš°ë„ ìˆë‹¤.
* spring data jpa ì™€ querydsl ì—ì„œëŠ” í˜ì´ì§•ì„ êµ¬í˜„í•˜ê¸° ìœ„í•œ ì—¬ëŸ¬ ë°©ë²•ì„ ì œê³µí•´ì¤€ë‹¤.

## Spring DATA JPA

#### Page, Slice ê°ì²´
* ìŠ¤í”„ë§ DATA-JPA ì˜ ì¿¼ë¦¬ ë©”ì†Œë“œì— return type ì„ Page, Slice ë¡œ ì§€ì •í•˜ê³  method parameter ì— Pageable ê°ì²´ë¥¼ ë„£ìœ¼ë©´ í˜ì´ì§• ê²°ê³¼ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤.
* Page\<T\>
  * total count ë° í˜ì´ì§•ê³¼ ê´€ë ¨ëœ ëª¨ë“  ë°ì´í„°ê°€ í•¨ê»˜ ì¡°íšŒë˜ì–´ ì˜¨ë‹¤. ë³´í†µ í˜ì´ì§•ì—ì„œ total count ì— ëŒ€í•œ ì„±ëŠ¥ì´ ì•ˆë‚˜ì˜¤ëŠ” ê²½ìš°ê°€ ìˆë‹¤.
* Slice\<T\>
  * Page ì™€ ë‹¬ë¦¬ total count ë¥¼ ì œì™¸í•œ í˜ì´ì§• ì •ë³´ë¥¼ ë„˜ê²¨ì¤€ë‹¤. limit + 1 ë¡œ ê²°ê³¼ë¥¼ ì¡°íšŒí•˜ì—¬ ë‹¤ìŒ í˜ì´ì§€ê°€ ìˆëŠ”ì§€ ì—†ëŠ”ì§€ë§Œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
 
#### Page ì—ì„œ Count ì¿¼ë¦¬ ë¶„ë¦¬í•˜ëŠ” ë°©ë²•
* Page ê°ì²´ì—ëŠ” total count ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤. ê·¸ëŸ°ë° total count ë¥¼ êµ¬í•˜ê¸° ìœ„í•´ì„œëŠ” í…Œì´ë¸”ì˜ row ë¥¼ ì „ë¶€ ì„¸ì•¼í•˜ê¸° ë•Œë¬¸ì— ì„±ëŠ¥ë©´ì—ì„œ ì•ˆì¢‹ì„ ìˆ˜ ë°–ì— ì—†ë‹¤.
* í˜ì´ì§• ì²˜ë¦¬ê°€ ë°˜ë“œì‹œ í•„ìš”í•˜ë‹¤ë©´ total count ëŠ” ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤. ë°˜ë“œì‹œ 100% ì‹¤ì‹œê°„ì„±ì„ ë³´ì¥í•´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ì•„ë‹ˆë¼ë©´ total count ë¥¼ ë¶„ë¦¬í•˜ê³  ì¼ì • ì‹œê°„ ìºì‹±í•˜ë©´ count query ì˜ í˜¸ì¶œì„ ì¤„ì¼ ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.
* êµ¬í˜„ ë°©ë²•
  1. @Query - countQuery ì˜µì…˜
    * @Query ë¡œ JPQL ì„ ì‘ì„±í• ë•Œ countQuery ë¥¼ ë³„ë„ë¡œ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.
      ```java
      @Query(
        value = "select m from Member m left join m.team t",
        countQuery = "select count(m.username) from Member m"
      )
      ```
      * í•˜ì§€ë§Œ ì´ ë°©ë²•ì€ count ë§Œ ìºì‹±í•  ìˆ˜ ì—†ë‹¤.
  2. ë³„ë„ì˜ ë©”ì†Œë“œë¡œ ë¶„ë¦¬
    * countQuery ê°€ ì•„ë‹ˆë¼ ë³„ë„ì˜ ë©”ì†Œë“œë¡œ ë¶„ë¦¬í•´ì•¼ ìºì‹±í•˜ê¸° ì‰½ë‹¤.
    
#### (ì£¼ì˜ğŸ’¡) Page ì˜ ì¹´ìš´íŠ¸ ì¿¼ë¦¬
* ì˜ˆë¥¼ ë“¤ì–´ í˜ì´ì§€ë¥¼ 10ê±´ ë‹¨ìœ„ë¡œ í•˜ëŠ”ë°, ì²˜ìŒì— 10ê±´ ë¯¸ë§Œìœ¼ë¡œ ì¡°íšŒëœ ê²½ìš° count ì¿¼ë¦¬ë¥¼ ë”°ë¡œ í˜¸ì¶œí•  í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì— countQuery ê°€ í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤.

## QueryDSL
* êµ¬í˜„ ë°©ë²•
  1. JPAQueryFactory - fetchResults()
    * fetchResults() ë¡œ QueryResults\<T\> ê°ì²´ë¥¼ ë°˜í™˜ë°›ìœ¼ë©´ í•´ë‹¹ ê°ì²´ì— ì—¬ëŸ¬ ê°€ì§€ ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤.
      ```java
      QueryResults<Member> queryResult = queryFactory
        .selectFrom(member)
        .orderBy(member.username.desc())
        .offset(1)
        .limit(2)
        .fetchResults();  // count ì¿¼ë¦¬ê¹Œì§€ í¬í•¨

      queryResult.getTotal();
      queryResult.getLimit();
      queryResult.getOffset();
      queryResult.getResults();
      ```
  2. QuerydslRepositorySupport
    * Custom Repository ì—ì„œ QuerydslRepositorySupport ë¥¼ ìƒì†ë°›ìœ¼ë©´ í˜ì´ì§• í¸ì˜ ë©”ì†Œë“œ ì œê³µ
    * QuerydslRepositorySupport ì˜ querydsl ì„ ì´ìš©í•˜ì—¬ applyPagination() ë©”ì†Œë“œ í˜¸ì¶œ
      ```java
      public Page<Member> searchMembersByName(String name, Pageable pageable) {
        final query = queryFactory
          .select(member)
          .from(member)
          .where(member.name.startsWith(name))
          .orderBy(member.name.desc());
          
        return new PageImpl<>(
          // getQuerydsl() ì€ QuerydslRepositorySupport ì˜ ë©”ì†Œë“œ
          getQuerydsl().applyPagination(pageable, query).fetch(),
          pageable,
          query.fetchCount());
      }
      ```

